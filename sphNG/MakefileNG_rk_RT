##############################################################
###                                                        ###
###           Make File for the GRAPE SPH Code             ###
###          Written by M. Bate and R. Klessen             ###
###                      March 1996                        ###
###                                                        ###
###     This compiles the code using the BINARY TREE       ###
###                                                        ###
### (NOTE: As well as the different Makefile, `igrape'     ###
### must be changed when switching between GRAPE and TREE) ###
###                                                        ###
##############################################################

.KEEP_STATE:

FORTRAN = xlf_r -qnosave
FC = xlf_r -qnosave
#FC = xlf90_r -qfixed=72
#RENAMES = -brename:.itime,.itime_ -brename:.idate,.idate_ \
#          -brename:.etime,.etime_ -brename:.flush,.flush_
RENAMES = 

##############################################################
### Prepare for debugging                                  ###
##############################################################

#FFLAGS = -O5 -qalign=4k -qautodbl=dbl4 -q64 -qsmp
#ZZFFLAGS = -O3 -q64 -qsmp=noauto -qextname
ZFFLAGS= -O3 -q64  -qextname -qsmp=noauto
#ZFFLAGS=  -q64  -qextname 
ZZFFLAGS = ${ZFFLAGS} # -qflttrap=enable:invalid:zerodivide -g -C -qsigtrap -qfloat=nans 
#ZZFFLAGS = -O3 -q64 -qextname # -C -qsigtrap -g
FFLAGS = ${ZZFFLAGS} -qrealsize=8 

SOURCES= sph.f accrete_P.f addump.f angmom.f boundry.f \
	cartdis.f cartmas.f cartpres.f cartvel.f chanref.f \
	chekopt.f condense.f constan.f coriol.f cyldis.f cylmas.f cylpres.f \
	cylvel.f densityi_P.f derivi_P_RT.f endrun.f energ.f eospg.f \
	error.f evol.f externf.f extract.f \
        file.f forcei_P.f getneigh.f \
	getcv.f get1overmu.f getkappa.f \
	gforsa_P.f gforsn_P.f gforspt_P.f \
	ghostp1.f ghostp2.f ghostp3.f ghostp11.f ghostp100.f \
        gptall.f hcalc.f hdot_P.f \
	header.f homexp.f indexx.f indexx2.f indexx3.f inform.f \
	inopts.f insulate_TREE_P.f integs.f ktable.f labrun.f lunit_double.f \
	mainop.f mesop.f mhdparams_mhd.f modif.f mtree_P.f \
	newrun.f options.f phoenix.f phoenix2.f \
	place.f preset.f \
	prout.f ran1.f rdump.f reduce.f revtree_P.f save.f \
        scaling.f secmes.f setBfield_mhd.f setpart.f smoothd_P.f \
	sphdis.f sphmas.f sphpres.f sphvel.f step_P.f \
	toten.f treef_P.f unifdis.f unit.f \
	wdump.f wrinsph.f zzsun_f77_double1.f ass.f newgsimpl_P5_sor.f \
	quartic_gs1t.f

OBJECTS = $(SOURCES:.f=.o) zzsun_f77_double2.o

build: sph_tree_rk_RT

zzsun_f77_double2.o: zzsun_f77_double2.f
			     $(FC) -c $(ZZFFLAGS) zzsun_f77_double2.f -o zzsun_f77_double2.o

sph_tree_rk_RT: $(OBJECTS)
	$(FC) $(FFLAGS) -o $@ $(OBJECTS)

clean:
	\rm -f *.o sph_tree_rk_RT
